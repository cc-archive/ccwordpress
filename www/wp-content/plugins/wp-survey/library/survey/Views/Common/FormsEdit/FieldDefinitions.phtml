<div id="normal-sortables" class="meta-box-sortables">
<div id="fielddef" class="postbox " > 
<div class="handlediv" title="Click to toggle"><br /></div><h3 class='hndle'><span>Field Definitions</span></h3> 
<div class="inside"> 
<div id="fielddefstuff"> 
<?php
	$fields = array('Name','Type','Mandatory','Values','Default','Position');
	$cnt=0;
	foreach($this->options['fields'] as $field): 
		$cnt++;
		$user = false;
		if(in_array($field['Type'],array('name','email','submit')))
		{
			$user = true;
		}
		$multi='';
		if(in_array('checkbox',explode(',',$this->options['types'])))
		{
			$multi=', 30 characters in the case of multi-value checkboxes';
		}
		foreach($fields as $hidden):
?>
<input type='hidden' name="fields[<?php echo $cnt;?>][<?php echo $hidden?>]" value="<?php if(isset($field[$hidden])) {echo $field[$hidden];};?>"/>
<?php endforeach;?>
<table class="widefat" cellspacing="0">
	<thead>
		<tr>
			<th style='width:90px'>
			<?php if($this->options['settings_columns']['position'] != ''):?>
				<?php if($field['Type'] == ''):?>
					New Field<input type = 'hidden' name='fields[<?php echo $cnt;?>][Position]' value='9999999999' />
				<?php else:?>
					<?php echo $this->options['settings_columns']['position']?> #<input size=2 type = 'text' name='fields[<?php echo $cnt;?>][Position]' value='<?php echo $cnt;?>' />
				<?php endif;?>	
			<?php endif;?>	
			</th>
			<th style='width:130px'>
			<?php if(!($this->options['settings_columns']['delete']=='' || $user || $field['Type'] == '')): ?>
			<input type = 'checkbox' name='fields[<?php echo $cnt;?>][delete]' value='' />&nbsp;<?php echo $this->options['settings_columns']['delete']?>
			<?php endif;?>
			</th>
			<th></th>
		</tr>
	</thead>
	<tbody>
	<tr class='<?php echo $this->alternate(true);?>'>
		<th valign=top><?php echo $this->options['settings_columns']['type']?></th>
		<td>
		<?php if((count($this->types)==1 || $user) && $field['Type']!=''):?>
			<input type=hidden  name='fields[<?php echo $cnt;?>][Type]' value='<?php echo $field['Type'];?>'/>&nbsp;<?php echo $field['Type'];?>
		<?php else:?>
			<select name='fields[<?php echo $cnt;?>][Type]'>
				<?php if($field['Type'] == ''):?>
					<option></option>
				<?php endif;?>
			<?php foreach($this->types as $type):?>
				<option <?php if($field['Type'] == $type){echo 'selected';}?>><?php echo $type;?></option>
			<?php endforeach?>
			</select>
		<?php endif;?><br/>
		</td>
<?php if(!($field['Type']=='submit')): ?>
		<th valign=top><?php echo $this->options['settings_columns']['mandatory']?>&nbsp;<?php if($user){?>&nbsp;
				<input  name='fields[<?php echo $cnt;?>][Mandatory]' type=hidden value='yes'/><input type=checkbox disabled checked />
					<?php }else{?><input class='checkbox' <?php if(isset($field['Mandatory']) && strtolower($field['Mandatory'])=='yes'){echo 'checked';}?> type = 'checkbox' name='fields[<?php echo $cnt;?>][Mandatory]' value='yes' />
		<?php }?>
		</th>
<?php else:?>
<td colspan=2></td>
<?php endif;?>
	</tr>
	<tr class='<?php echo $this->alternate();?>'>
		<th  valign=top><?php echo $this->options['settings_columns']['name']?></th>
		<td colspan=2>
		<?php if($user || $this->options['settings_columns']['name']!='Question'):?>
			<input class='admin_text info' title="The prompt for the field ( HTML is allowed ).<?php
		if(!$user && $this->options['table'])
		{
			echo ' This will also used for field name in MySQL and the CVS download ( HTML tags will be removed and it will be truncated to 60 characters'.$multi.' ).';
		}	
		?>" type = 'text' name='fields[<?php echo $cnt;?>][Name]' value='<?php echo $field['Name'];?>' />
		<?php else:?>
			<textarea class='admin_text info' title="The prompt for the field ( HTML is allowed ).<?php
		if(!$user && $this->options['table'])
		{
			echo ' This will also used for field name in MySQL and the CVS download ( HTML tags will be removed and it will be truncated to 60 characters'.$multi.' ).';
		}	
		?>"rows="5"  name='fields[<?php echo $cnt;?>][Name]'><?php echo $field['Name'];?></textarea>
		<?php endif;?>
	</td>
	</tr>
<?php if(!($this->options['settings_columns']['values']=='' || $user)): ?>
	<tr class='<?php echo $this->alternate();?>'>
		<th valign=top><?php echo $this->options['settings_columns']['values']?></th>
		<td colspan=2>
			<textarea class='admin_text info' title="( 1 per Line ). A list of values the user may choose. Applies only to text, radio, and checkbox." rows="5"  name='fields[<?php echo $cnt;?>][Values]'><?php echo $field['Values'];?></textarea><br/>
		</td>
	</tr>
<?php endif;?>
<?php if(!($this->options['settings_columns']['default']=='' || $user)): ?>
	<tr class='<?php echo $this->alternate();?>'>
		<th valign=top><?php echo $this->options['settings_columns']['default']?></th>
		<td colspan=2>
			<input class='admin_text' type = 'text' name='fields[<?php echo $cnt;?>][<?php echo $this->options['settings_columns']['default']?>]' value='<?php echo $field[$this->options['settings_columns']['default']];?>' />
		</td>
	</tr>
<?php endif;?>
	</tbody>
</table>
<?php endforeach;?>
</div> 
</div> 
</div> 
</div>