##### ------------------ NOTE ----------------- #####
#
# IF YOU ADD NEW RULES AND/OR CONFIGURATIONS TO THIS
# FILE, PLEASE COMMENT, DATE AND SIGN THEM SO THAT WE
# CAN KNOW WHO DID WHAT AND WHY AND WHEN.
#
##### ----------------------------------------- #####

FileETag INode MTime Size

<Location /licenses>
    DirectoryIndex deed
    DefaultType text/html
    AddDefaultCharset utf-8
</Location>

Options +ExecCGI

# Adding support for /home/<user>/public_html (nkinkade 2007-12-13)
<IfModule mod_userdir.c>
    UserDir public_html
    UserDir disabled root
    <Directory /home/*/public_html>
        RewriteEngine off
        AllowOverride FileInfo AuthConfig Limit
        Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec
    </Directory>
</IfModule>

### ------------------------- ####
##   BEGIN mod_rewrite SECTION  ##
### ------------------------- ####

RewriteEngine on

# Uncomment these lines and adjust the log level for debugging.
# Make sure to recomment them and restart Apache when done.
#    RewriteLog /tmp/rewrite.log
#    RewriteLogLevel 7

RewriteMap uppercase int:toupper

# Per Mike, redirect anything coming to www.creativecommons.org to plain
# creativecommons.org (nkinkade 2007-11-02)
RewriteCond %{SERVER_NAME} =www.creativecommons.org
RewriteRule ^/(.*)$ http://%{SERVER_NAME}/$1 [L,R=301] 

# Don't allow anyone to access legalcode directly via the /legalcode directory.
# The following rule should be sufficient to induce a 404 error, unless by some
# astounding coincidence someone puts a file or directory called 'roflcopter'
# in the webroot.  For more info about 'roflcopter' see the cc_permalink_mapper
# plugin.  (nkinkade 2007-12-18)
RewriteRule ^/legalcode /index.php?p=9999999999&roflcopter [L]

# Changing the following rule so that we can handle languages that are denoted using
# more than a 2 char lowercase code.  The was spurred by the examle of the Serbian
# licenses, which are in both Cyrillic and Latin scripts which some sources indicate
# should be identified as sr-Latn and sr-Cyrl.  (nkinkade 2008-01-04)
#RewriteRule ^/licenses/(.*)/([0-9]\.[0-9])/(.*)/legalcode\.([a-z][a-z])$ /legalcode/$1_$2_$3_$4.html [L]
RewriteRule ^/licenses/(.*)/(\d\.\d)/(.*)/legalcode\.([A-Za-z-]+)$ /legalcode/$1_$2_$3_$4.html [L]

# Map legalcode/rdf requests to the appropriate file.  NOTE:  these rules must appear
# before the rule below that catches all requests to /licenses/by* where the
# file doesn't actually exist.
RewriteRule ^/licenses/(.*)/([0-9]\.[0-9])/legalcode\.([a-z][a-z])$ /legalcode/$1_$2_$3.html [L]
RewriteRule ^/licenses/(.*)/([0-9]\.[0-9])/(.*)/legalcode$ /legalcode/$1_$2_$3.html [L]
RewriteRule ^/licenses/(.*)/([0-9]\.[0-9])/legalcode$ /legalcode/$1_$2.html [L]
RewriteRule ^/licenses/(.*)/([0-9]\.[0-9])/([a-z]+)/license_rdf$ /license_rdf/creativecommons.org_licenses_$1_$2_$3_.rdf [L,T=application/rdf+xml]
RewriteRule ^/licenses/(.*)/([0-9]\.[0-9])/([a-z]+)/rdf$ /license_rdf/creativecommons.org_licenses_$1_$2_$3_.rdf [L,T=application/rdf+xml]
RewriteRule ^/licenses/(.*)/([0-9]\.[0-9])/license_rdf$ /license_rdf/creativecommons.org_licenses_$1_$2_.rdf [L,T=application/rdf+xml]
RewriteRule ^/licenses/(.*)/([0-9]\.[0-9])/rdf$ /license_rdf/creativecommons.org_licenses_$1_$2_.rdf [L,T=application/rdf+xml]

# Any request that comes in to /international/xx should be redirected to
# /international/xx/ (trailing slash).  Otherwise the relative links to the
# translated-license.pdf file will fail to point to the right place on mirrors.
# This problem was brough to my attention via an email exchange with Michelle
# Thorne and Ben of CC Hong Kong (nkinkade 2008-02-26)
RewriteRule ^/international/(\w\w)$ http://%{SERVER_NAME}/international/$1/ [R=301,L]

# If a particular jurisdiction has a page at /international or /worldwide, but doesn't
# yet have the deeds and or licenses available, then don't show the /international/<code>
# page when someone tries to access the licenses.  A recent example:  The Philippenes had
# a page at /international/ph/ ... this page had a slug of 'ph'.  However the licenses
# still weren't ready, yet accesses to /licenses/<type>/<version>/ph/ were
# returning the /international/ph/ page because, apparently, Wordpress was interpreting the
# 'ph' as a page slug.  So we just redirect the original request to some (hopefully)
# impossible URL that should return a 404.  For more info about 'roflcopter' see the
# cc_permalink_mapper plugin.  (nkinkade 2007-12-18)
RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-d
RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-f
RewriteRule ^/licenses/by.*?/\d\.\d/[a-z]+/ /index.php?p=9999999999&roflcopter [L]

# Static License Deeds -- NRY
#  Rewrite the filenames, normalizing the locale naming
# RewriteRule ^/licenses/(.*)/deed\.([a-z]+)([_\-])([a-z]+) /licenses/$1/deed.$2_${uppercase:$4} [R,L]

# License Engine -- NRY
#  If the file does not exist, pass it to Zope; note that we include /licenses
#  here even though 99% of those files are statically served since a few are
#  not.  Passing to Zope handles i18n for us.
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^/(license|licenses|characteristic)/(.*) http://127.0.0.1:9080/++vh++http:%{SERVER_NAME}:80/++/$1/$2 [L,P]
RewriteRule ^/licenses/disclaimer-popup$ http://127.0.0.1:9080/++vh++http:%{SERVER_NAME}.org:80/++/licenses/disclaimer-popup [L,P]
RewriteRule ^/licenses/$ http://127.0.0.1:9080/++vh++http:%{SERVER_NAME}:80/++/licenses/ [L,P]

# To handle /international - oct 1, 2007 (aroberts)
RewriteRule ^/worldwide(.*) http://%{SERVER_NAME}/international$1 [R]

# Sorted list of rewrite rules that have no comments. (nkinkade 2008-01-22)
RewriteRule ^/200.* http://%{SERVER_NAME}/ [R]
RewriteRule ^/about/affiliates.*$ http://%{SERVER_NAME}/about/supporters [R]
Rewriterule ^/about/history http://wiki.creativecommons.org/History [R,L]
RewriteRule ^/about/legal/cultivating http://wiki.creativecommons.org/Cultivating_the_Public_Domain [R,L]
RewriteRule ^/about/legal/?$  http://wiki.creativecommons.org/Legal_Concepts [R,L]
RewriteRule ^/about/license$ http://%{SERVER_NAME}/about/licenses [L,R]
Rewriterule ^/about/licenses/comics1 http://wiki.creativecommons.org/Spectrumofrights_Comic1 [R,L]
Rewriterule ^/about/licenses/comics2 http://wiki.creativecommons.org/Spectrumofrights_Comic2 [R,L]
Rewriterule ^/about/licenses/comics3 http://wiki.creativecommons.org/Spectrumofrights_Comic3 [R,L]
Rewriterule ^/about/licenses/comics4 http://wiki.creativecommons.org/Spectrumofrights_Comic4 [R,L]
Rewriterule ^/about/licenses/examples http://wiki.creativecommons.org/License_Examples [R,L]
Rewriterule ^/about/licenses/fullrights http://wiki.creativecommons.org/Baseline_Rights [R,L]
Rewriterule ^/about/licenses/how1 http://wiki.creativecommons.org/Howitworks_Comic1 [R,L]
Rewriterule ^/about/licenses/how2 http://wiki.creativecommons.org/Howitworks_Comic2 [R,L]
Rewriterule ^/about/licenses/how3 http://wiki.creativecommons.org/Howitworks_Comic3 [R,L]
Rewriterule ^/about/licenses/how4 http://wiki.creativecommons.org/Howitworks_Comic4 [R,L]
RewriteRule ^/about/supporters$ http://support.creativecommons.org/supporters$1 [R,L]
RewriteRule ^/aboutus/(.*)$ http://%{SERVER_NAME}/learn/aboutus/$1 [R]
RewriteRule ^/apps/(.*) http://127.0.0.1:8002/$1 [L,P]
RewriteRule .*/archive/archive.* http://%{SERVER_NAME}/ [R]
RewriteRule ^/audio/([-a-z0-9]+)/?$ /index.php?category_name=audio&name=$1 [QSA,L]
RewriteRule ^/audio/publish-internetarchive http://wiki.creativecommons.org/HOWTO_Publish#Internet_Archive [R,NE,L]
RewriteRule ^/audio/publish-morpheus http://wiki.creativecommons.org/HOWTO_Publish#Morpheus [R,NE,L]
RewriteRule ^/audio/publish-soundclick http://wiki.creativecommons.org/HOWTO_Publish#Soundclick [R,NE,L]
RewriteRule ^/audio/publish-website http://wiki.creativecommons.org/HOWTO_Publish#Adding_a_license_to_your_audio_page [R,NE,L]
RewriteRule .*/author$ http://%{SERVER_NAME}/ [R]
RewriteRule ^/commoners/([-a-z0-9]+)/?$ /index.php?category_name=commoners&name=$1 [QSA,L]
RewriteRule ^/concepts/examples$ http://%{SERVER_NAME}/learn/licenses/examples [R]
RewriteRule ^/concepts/(.*)$ http://%{SERVER_NAME}/learn/legal/$1 [R]
RewriteRule ^/contest/(.*)$ http://%{SERVER_NAME}/video/movingimagecontest [R]
RewriteRule ^/counter.* http://%{SERVER_NAME}/ [R]
RewriteRule ^(.*)CVS.*$ $1 [R]
RewriteRule ^/donate$ http://%{SERVER_NAME}/support/ [R]
RewriteRule ^/draft/(.*)$ http://%{SERVER_NAME}/learn/licenses/$1 [R]
RewriteRule /drafts/wiki_0.5$ http://%{SERVER_NAME}/licenses/by-sa/2.5/ [R]
RewriteRule ^/education/([-a-z0-9]+)/?$ /index.php?category_name=education&name=$1 [QSA,L]
RewriteRule ^/education/publish-website http://wiki.creativecommons.org/HOWTO_Publish#Adding_a_license_to_your_existing_website_2 [R,NE,L]
RewriteRule ^.*/embedding$ http://wiki.creativecommons.org/Embedded_Metadata [R]
RewriteRule ^/faq.*$ http://wiki.creativecommons.org/FAQ [R]
RewriteRule ^/favicon.ico /favicon.ico [L]
RewriteRule ^/features(.*)$ http://%{SERVER_NAME}/learn/features$1 [R]
RewriteRule ^/find.*$ http://search.creativecommons.org/ [R]
RewriteRule ^/freeculture.*$ http://lessig.org/freeculture [R]
RewriteRule ^/getcontent.*$ http://%{SERVER_NAME}/find/ [R]
RewriteRule ^/http.* http://%{SERVER_NAME}/ [R]
RewriteRule http http://%{SERVER_NAME}/ [R]
RewriteRule ^/_.* http://%{SERVER_NAME}/ [R]
RewriteRule ^/icon/(.*)$ http://%{SERVER_NAME}/icons/$1 [R]
RewriteRule ^/icons/(.*) /icons/$1 [L]
RewriteRule ^/image/([-a-z0-9]+)/?$ /index.php?category_name=image&name=$1 [QSA,L]
RewriteRule ^/image/publish-buzznet http://wiki.creativecommons.org/HOWTO_Publish#Buzznet [R,NE,L]
RewriteRule ^/image/publish-flickr http://wiki.creativecommons.org/HOWTO_Publish#Flickr [R,NE,L]
RewriteRule ^/image/publish-website http://wiki.creativecommons.org/HOWTO_Publish#Adding_a_license_to_your_photo_pages [R,NE,L]
RewriteRule ^/images.*/$ http://%{SERVER_NAME}/ [R]
RewriteRule ^/images/(.*) /images/$1 [L]
RewriteRule ^/includes/(.*) /includes/$1 [L]
RewriteRule index_html http://%{SERVER_NAME}/ [R]
RewriteRule ^/$ /index.php [L,P]
RewriteRule /learn/aboutus/affiliates$ http://%{SERVER_NAME}/about/affiliates [R]
RewriteRule /learn/aboutus/$ http://%{SERVER_NAME}/about/history [R]
RewriteRule /learn/aboutus/people$ http://%{SERVER_NAME}/about/people [R]
RewriteRule /learn/aboutus/supporters$ http://%{SERVER_NAME}/about/supporters [R]
RewriteRule /learn/artistscorners/educators$ http://%{SERVER_NAME}/education/ [R]
RewriteRule /learn/artistscorners/filmmakers$ http://%{SERVER_NAME}/video/ [R]
RewriteRule /learn/artistscorners/$ http://%{SERVER_NAME}/ [R]
RewriteRule /learn/artistscorners/musicians$ http://%{SERVER_NAME}/audio/ [R]
RewriteRule /learn/artistscorners/photographers$  http://%{SERVER_NAME}/image/ [R]
RewriteRule /learn/artistscorners/writers$ http://%{SERVER_NAME}/text/ [R]
RewriteRule ^/learn/collaborators$ http://%{SERVER_NAME}/learn/aboutus/affiliates [R]
RewriteRule ^/learn/features/(.*)$ http://%{SERVER_NAME}/find/ [R]
RewriteRule ^/learn/getcontent$ http://%{SERVER_NAME}/find/ [R]
RewriteRule /learn/$ http://%{SERVER_NAME}/about/ [R]
RewriteRule /learn/legal/$ http://%{SERVER_NAME}/about/legal/ [R]
RewriteRule /learn/licenses/.*$ http://%{SERVER_NAME}/about/licenses/ [R]
RewriteRule /learn/licenses$ http://%{SERVER_NAME}/about/licenses/ [R]
RewriteRule .*legalcode/$ http://%{SERVER_NAME}/ [R]
RewriteRule ^/legal/.*$ http://%{SERVER_NAME}/ [R]
RewriteRule (.*)licence(.*) http://creativecommons.org$1license$2 [R]
RewriteRule ^/license/cc-gpl-br$ http://%{SERVER_NAME}/license/cc-gpl [R]
RewriteRule ^/license/cc-lgpl-br$ http://%{SERVER_NAME}/license/cc-lgpl [R]
RewriteRule ^/license/devnations$ http://%{SERVER_NAME}/retiredlicenses [R]
RewriteRule ^/license$ http://%{SERVER_NAME}/license/ [L,R]
RewriteRule ^/(license|licenses)/@@/cc/(.*)$ /$2 [L]
RewriteRule ^/(license|licenses)/@@/cc/cc3/(.*)$ /wp-content/themes/cc3/$2 [L]
RewriteRule ^/(license|licenses)/@@/cc/cc4/(.*)$ /wp-content/themes/cc4/$2 [L]
RewriteRule ^/license/meet-the-licenses$ http://%{SERVER_NAME}/about/licenses/meet-the-licenses [R]
RewriteRule ^/license/pngie.htc$ /includes/pngie.htc [L]
RewriteRule ^/license/publicdomain/?$ http://%{SERVER_NAME}/license/publicdomain-2/ [L,R]
RewriteRule ^/licenses/(.*)/([0-9]\.[0-9])/([a-z][a-z])$ http://%{SERVER_NAME}/licenses/$1/$2/$3/ [R]

RewriteRule ^/licenses/(.*)/([0-9]\.[0-9])/([Ss]cotland)$ http://%{SERVER_NAME}/licenses/$1/$2/scotland/ [R]
RewriteRule ^/licenses/(.*)([0-9])$ http://%{SERVER_NAME}/licenses/$1$2/ [R]
RewriteRule ^/licenses/(.*)/2.0/ar/(.*)$ http://%{SERVER_NAME}/licenses/$1/2.5/ar/$2 [R]
RewriteRule ^/licenses/BSD/legalcode http://opensource.org/licenses/bsd-license.php [L,R]
RewriteRule ^/licenses/by-nc-nd/1.0/(.*)$ http://%{SERVER_NAME}/licenses/by-nd-nc/1.0/$1 [R]
RewriteRule ^/licenses/by-nc-nd/2.0/deed-music$ http://creativecommons.org:81/licenses/by-nc-nd/2.0/ [L,P]
RewriteRule ^/licenses/by-nd-nc/2.0/(.*)$ http://%{SERVER_NAME}/licenses/by-nc-nd/2.0/$1 [R]
RewriteRule ^/licenses/(.*)/deed.(.*)/$ http://%{SERVER_NAME}/ [R]
RewriteRule ^/licenses$ http://%{SERVER_NAME}/licenses/ [R]
RewriteRule ^/licenses/index.rdf$ /rdf/index.rdf [L,T=application/rdf+xml]
RewriteRule ^/licenses/meet-the-licenses$ http://%{SERVER_NAME}/about/licenses/meet-the-licenses [R]
RewriteRule ^/licenses/MIT/legalcode http://opensource.org/licenses/mit-license.php [L,R]
RewriteRule ^/licenses/publicdomain/1.0(.*)$ http://%{SERVER_NAME}/licenses/publicdomain/ [R]
RewriteRule ^/licenses/(.*)sampling\+/1.0/(.*)/legalcode$ /legalcode/$1samplingplus_1.0_$2.html [L]
RewriteRule ^/licenses/(.*)sampling\+/1.0/legalcode$ /legalcode/$1samplingplus_1.0.html [L]
RewriteRule ^/licesne(.*)$ http://%{SERVER_NAME}/license$1 [R]
RewriteRule .*/login_form$ http://%{SERVER_NAME}/ [R]
RewriteRule .*/manage.*$ http://%{SERVER_NAME}/ [R]
RewriteRule ^/metadata(.*)$ http://wiki.creativecommons.org/Metadata [R]
RewriteRule ^/news/blog/$ http://%{SERVER_NAME}/weblog/ [R]
RewriteRule ^/news/pressarchive.html$ http://%{SERVER_NAME}/press/archive [R]
RewriteRule ^/news/pressarchive$ http://%{SERVER_NAME}/press/archive [R]
RewriteRule ^/news/pressreleases.html$ http://%{SERVER_NAME}/press-releases/archive-short [R]
RewriteRule ^/news/pressreleases$ http://%{SERVER_NAME}/press-releases/archive-short [R]
RewriteRule ^/participate$ http://wiki.creativecommons.org/ [R]
RewriteRule ^/(.*?.pdf)$ http://mirrors.creativecommons.org/$1 [R]
RewriteRule ^/policy$ http://%{SERVER_NAME}/policies [R]
RewriteRule ^/pressarchive$ http://%{SERVER_NAME}/press/archive [R]
RewriteRule ^/press$ http://%{SERVER_NAME}/press/ [R]
RewriteRule ^/press/.*$ http://%{SERVER_NAME}/weblog/archive/ [R]
RewriteRule ^/press$ http://%{SERVER_NAME}/weblog/archive/ [R]
RewriteRule ^/presskit/(.+)\.([a-z]+)$ http://mirrors.creativecommons.org/presskit/$1.$2 [R]
RewriteRule ^/project/(.*) http://wiki.creativecommons.org/$1 [R]
RewriteRule ^/projects/founderscopyright.*$ - [L]
RewriteRule ^/projects/(.+) http://wiki.creativecommons.org/$1 [R,NE,L]
RewriteRule ^/projects/international(.*)$ http://%{SERVER_NAME}/worldwide$1 [R]
RewriteRule /projects/sampling http://%{SERVER_NAME}/about/sampling [R]
RewriteRule ^/projects/science(.*)$ http://science.creativecommons.org/ [R]
RewriteRule .*rdf/$ http://%{SERVER_NAME}/ [R]
RewriteRule ^/robots.txt$ /robots.txt [L]
RewriteRule /salon.*$ http://wiki.creativecommons.org/Salon [R]
RewriteRule ^/science.*$ http://sciencecommons.org/ [R]
RewriteRule ^/store$ http://%{SERVER_NAME}/support/ [R]
RewriteRule /support/getabutton$ http://%{SERVER_NAME}/support/supportcc [R]
RewriteRule ^/support(.*) http://support.creativecommons.org$1 [R,L]
RewriteRule /support/summit$ http://%{SERVER_NAME}/support/ [R]
RewriteRule /support/video$ http://%{SERVER_NAME}/support/videos [R]
RewriteRule /technology/accessories$ http://wiki.creativecommons.org/Browser_Plugin [R]
RewriteRule /technology/challenges$ http://wiki.creativecommons.org/TechChallenges [R]
RewriteRule ^/technology/contributor.*$ http://wiki.creativecommons.org/Developer [R]
RewriteRule ^/technology/$ http://wiki.creativecommons.org/Developer [R]
RewriteRule ^.*/technology/.*$ http://wiki.creativecommons.org/Developer [R]
RewriteRule ^/technology/mp3$ http://wiki.creativecommons.org/MP3 [R]
RewriteRule ^/technology/screen.*$ http://wiki.creativecommons.org/Developer [R]
RewriteRule ^/technology/search.html$ http://search.creativecommons.org/ [R]
RewriteRule ^/technology/usingmarkup$ http://wiki.creativecommons.org/UsingMarkup [R]
RewriteRule ^/technology/web$ http://wiki.creativecommons.org/HOWTO_Tag_HTML_pages [R]
RewriteRule ^/technology/web-integration$ http://wiki.creativecommons.org/Web_Integration_Guide [R]
RewriteRule ^/technology/xmp.*$ http://wiki.creativecommons.org/XMP [R]
RewriteRule ^/text/([-a-z0-9]+)/?$ /index.php?category_name=text&name=$1 [QSA,L]
RewriteRule ^/text/publish-weblogs http://wiki.creativecommons.org/HOWTO_Publish#Blog [R,NE,L]
RewriteRule ^/text/publish-website http://wiki.creativecommons.org/HOWTO_Publish#Adding_a_license_to_your_existing_website [R,NE,L]
RewriteRule ^/tools/cclookup http://wiki.creativecommons.org/CcLookup [R]
RewriteRule ^/tools/ccpublisher http://wiki.creativecommons.org/CcPublisher [R]
RewriteRule ^/video/([-a-z0-9]+)/?$ /index.php?category_name=video&name=$1 [QSA,L]
RewriteRule ^/video/publish-internetarchive http://wiki.creativecommons.org/HOWTO_Publish#Internet_Archive_2 [R,NE,L]
RewriteRule ^/video/publish-website http://wiki.creativecommons.org/HOWTO_Publish#Adding_a_license_to_your_video_page [R,NE,L]
RewriteRule ^/wiki.* http://wiki.creativecommons.org/ [R]
RewriteRule ^/worldwide/(..)$ http://%{SERVER_NAME}/worldwide/$1/ [R]
RewriteRule ^/(worldwide|international)/translating http://wiki.creativecommons.org/Translating [R]
