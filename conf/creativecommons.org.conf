#----------
# Main (general configs)
#----------

# Never, ever spit out ugly and scary PHP errors to users of the live site.
php_value display_errors 0

FileETag INode MTime Size

Options +ExecCGI

SuexecUserGroup webadmin webadmin

<Location /licenses>
	DirectoryIndex deed
	DefaultType text/html
	AddDefaultCharset utf-8
</Location>

<Location /ccengine-fcgi>
	DefaultType text/html
	AddDefaultCharset utf-8
</Location>

<Location /cc.engine-cache>
	DefaultType text/html
	AddDefaultCharset utf-8
</Location>

# Always serve up deeds as text/html, even when the country code
# extension makes Apache think it's something else, like .pl being
# a perl script instead of Poland, but not if it's a CSS file.
<LocationMatch "^/licenses/.*/deed(?!3.css).*$">
	ForceType text/html
</LocationMatch>

<LocationMatch "^/cc.engine-cache/.*/deed.*">
	ForceType text/html
</LocationMatch>

# Adding support for /home/<user>/public_html
<IfModule mod_userdir.c>
	UserDir public_html
	UserDir disabled root
	<Directory /home/*/public_html>
		RewriteEngine off
		AllowOverride FileInfo AuthConfig Limit
		Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec
	</Directory>
</IfModule>

# We only want relative URLs to point to creativecommons.org and nothing else
# like www.CC.org, etc.
UseCanonicalName On

# Let's have Apache set some caching options for most images on CC.org
<Directory /var/www/creativecommons.org/www/wp-content/uploads>
	ExpiresActive On
	ExpiresDefault A60480800
</Directory>

<Directory /var/www/creativecommons.org/www/images>
	ExpiresActive On
	ExpiresDefault A60480800
</Directory>


### ------------------------- ####
##   BEGIN mod_rewrite section  ##
### ------------------------- ####

RewriteEngine on

#----------
# Logging. Uncomment these lines and adjust the log level for debugging.  Make
# sure to recomment them and restart Apache when done because the file will
# become immense in a hurry.
#----------

#RewriteLog /tmp/rewrite.log
#RewriteLogLevel 5

#----------
# Config
#----------

RewriteMap uppercase int:toupper
RewriteMap intl2wiki txt:/var/www/creativecommons.org/conf/intl2wiki.map

# This rule doesn't do anything except set an env variable.  Since this common
# config is included in both the SSL and non-SSL vhost, we want any redirects
# to use the right protocol, and this env variable should serve that purpose.
RewriteCond %{SERVER_PORT}s ^(443(s)|[0-9]+s)$
RewriteRule ^.*$ - [env=reqproto:http%2]


#----------
# License engine and legalcode
#----------

Alias /ccengine-fcgi /var/www/creativecommons.org/cc.engine_env/ccengine.fcgi
Alias /cc.engine-cache /var/www/creativecommons.org/cc.engine_env/cache

# Redirect all /license to /choose before we go any deeper
RewriteRule ^/choose$ %{ENV:reqproto}://%{SERVER_NAME}/choose/ [L,R=301]
RewriteRule ^/license$ %{ENV:reqproto}://%{SERVER_NAME}/choose/ [L,R=301]

# Legalcode rewrites
RewriteRule ^/legalcode %{ENV:reqproto}://%{SERVER_NAME}/ [L,R=301]
RewriteRule .*legalcode/$ %{ENV:reqproto}://%{SERVER_NAME}/ [L,R=301]
RewriteRule ^/licenses/(.*)/([0-9]\.[0-9])/(.*)/legalcode\.([A-Za-z-]+)$ /legalcode/$1_$2_$3_$4.html [L]
RewriteRule ^/licenses/(.*)/([0-9]\.[0-9])/legalcode\.([a-z][a-z])$ /legalcode/$1_$2_$3.html [L] 
RewriteRule ^/licenses/(.*)/([0-9]\.[0-9])/(.*)/legalcode$ /legalcode/$1_$2_$3.html [L] 
RewriteRule ^/licenses/(.*)/([0-9]\.[0-9])/legalcode$ /legalcode/$1_$2.html [L] 
RewriteRule ^/licenses/(.*)/([0-9]\.[0-9])/legalcode\.txt$ /legalcode/$1_$2.txt [L] 
RewriteRule ^/licenses/(.*)sampling\+/1.0/(.*)/legalcode$ /legalcode/$1samplingplus_1.0_$2.html [L] 
RewriteRule ^/licenses/(.*)sampling\+/1.0/legalcode$ /legalcode/$1samplingplus_1.0.html [L] 
RewriteRule ^/publicdomain/(.*)/([0-9]\.[0-9])/legalcode$ /legalcode/$1_$2.html [L] 
RewriteRule ^/publicdomain/(.*)/([0-9]\.[0-9])/legalcode\.txt$ /legalcode/$1_$2.txt [L]

# License RDF rewrites
RewriteRule ^/licenses/(.*)/([0-9]\.[0-9])/([a-z]+)/license_rdf$ /license_rdf/creativecommons.org_licenses_$1_$2_$3_.rdf [L,T=application/rdf+xml]
RewriteRule ^/licenses/(.*)/([0-9]\.[0-9])/([a-z]+)/rdf$ /license_rdf/creativecommons.org_licenses_$1_$2_$3_.rdf [L,T=application/rdf+xml]
RewriteRule ^/licenses/index.rdf$ /rdf/index.rdf [L,T=application/rdf+xml]
RewriteRule ^/licenses/publicdomain/license_rdf$ /license_rdf/creativecommons.org_licenses_publicdomain_.rdf [L,T=application/rdf+xml]
RewriteRule ^/licenses/publicdomain/rdf$ /license_rdf/creativecommons.org_licenses_publicdomain_.rdf [L,T=application/rdf+xml]
RewriteRule ^/(publicdomain|licenses)/(.*)/([0-9]\.[0-9])/license_rdf$ /license_rdf/creativecommons.org_$1_$2_$3_.rdf [L,T=application/rdf+xml]
RewriteRule ^/(publicdomain|licenses)/(.*)/([0-9]\.[0-9])/rdf$ /license_rdf/creativecommons.org_$1_$2_$3_.rdf [L,T=application/rdf+xml]
RewriteRule .*rdf/$ %{ENV:reqproto}://%{SERVER_NAME}/ [L,R=301]

# See if deed is cached before sending to cc.engine
RewriteCond %{REQUEST_URI} ^/licenses
RewriteCond /var/www/%{SERVER_NAME}/cc.engine_env/cache/%{REQUEST_FILENAME} -s
RewriteRule ^/licenses/(.*) /cc.engine-cache/licenses/$1 [L,PT]

RewriteRule (.*)licence(.*) %{ENV:reqproto}://%{SERVER_NAME}$1license$2 [L,R=301]
RewriteRule ^/(license|choose|characteristic|publicdomain)$ /$1/ [L,R=301]
RewriteRule ^/(license|choose|characteristic|publicdomain)/(.*) /ccengine-fcgi/$1/$2 [PT,L]
RewriteRule ^/license/pngie.htc$ /includes/pngie.htc [L]
RewriteRule ^/licenses$ %{ENV:reqproto}://%{SERVER_NAME}/licenses/ [L,R=301]
RewriteRule ^/licenses/(.*)/([0-9]\.[0-9])/([a-z][a-z])$ %{ENV:reqproto}://%{SERVER_NAME}/licenses/$1/$2/$3/ [L,R=301]
RewriteRule ^/licenses/(.*)/([0-9]\.[0-9])/([Ss]cotland)$ %{ENV:reqproto}://%{SERVER_NAME}/licenses/$1/$2/scotland/ [L,R=301]
RewriteRule ^/licenses/(.*)([0-9])$ %{ENV:reqproto}://%{SERVER_NAME}/licenses/$1$2/ [L,R=301]
RewriteRule ^/licenses/(.*)/2.0/ar/(.*)$ %{ENV:reqproto}://%{SERVER_NAME}/licenses/$1/2.5/ar/$2 [L,R=301]
RewriteRule ^/licenses/BSD/legalcode http://opensource.org/licenses/bsd-license.php [L,R=301]
RewriteRule ^/licenses/by-nc-nd/2.0/deed-music$ %{ENV:reqproto}://%{SERVER_NAME}/licenses/by-nc-nd/2.0/ [L,R=301]
RewriteRule ^/licenses/(.*) /ccengine-fcgi/licenses/$1 [L,PT]
RewriteRule ^/licenses/(.*)/deed.(.*)/$ %{ENV:reqproto}://%{SERVER_NAME}/ [L,R=301]
RewriteRule ^/licenses/GPL/2.0/rdf$ http://www.gnu.org/licenses/gpl-2.0.rdf [L,R=301]
RewriteRule ^/licenses/LGPL/2.1/rdf$ http://www.gnu.org/licenses/lgpl-2.1.rdf [L,R=301]
RewriteRule ^/licenses/meet-the-licenses$ %{ENV:reqproto}://%{SERVER_NAME}/licenses/ [L,R=301]
RewriteRule ^/licenses/MIT/legalcode http://opensource.org/licenses/mit-license.php [L,R=301]
RewriteRule ^/licenses/publicdomain/1.0(.*)$ %{ENV:reqproto}://%{SERVER_NAME}/licenses/publicdomain/ [L,R=301]
RewriteRule ^/licenses/zero/1.0/(.*) /publicdomain/zero/1.0/$1 [L,R=301]
RewriteRule ^/licesne(.*)$ %{ENV:reqproto}://%{SERVER_NAME}/choose$1 [L,R=301]
RewriteRule ^/public_domain %{ENV:reqproto}://%{SERVER_NAME}/publicdomain/ [L,R=301]


#----------
# Old content/URLs going to new places
#----------

RewriteRule ^/200.* %{ENV:reqproto}://%{SERVER_NAME}/ [L,R=301]
RewriteRule ^/aboutus %{ENV:reqproto}://%{SERVER_NAME}/about [L,R=301]
RewriteRule ^/about/ccvideo %{ENV:reqproto}://%{SERVER_NAME}/videos/ [L,R=301]
RewriteRule ^/about/license$ %{ENV:reqproto}://%{SERVER_NAME}/licenses/ [L,R=301]
RewriteRule ^/about/licenses/?$ %{ENV:reqproto}://%{SERVER_NAME}/licenses/ [L,R=301]
RewriteRule ^/about/licenses/meet-the-licenses/?$ %{ENV:reqproto}://%{SERVER_NAME}/licenses/ [L,R=301]
RewriteRule /about/licenses/sampling %{ENV:reqproto}://%{SERVER_NAME}/about/licenses/ [R=301,L]
Rewriterule ^/about/people/alumni http://web.archive.org/*/http://creativecommons.org/about/people [L,R=301]
RewriteRule /about/sampling %{ENV:reqproto}://%{SERVER_NAME}/retiredlicenses [L,R=301]
RewriteRule /about/sampling-movie %{ENV:reqproto}://%{SERVER_NAME}/about/licenses/ [L,R=301]
RewriteRule ^/about/videos$ %{ENV:reqproto}://%{SERVER_NAME}/videos/ [L,R=301]
RewriteRule ^/about/what-is-cc/?$ %{ENV:reqproto}://%{SERVER_NAME}/about [L,R=301]
RewriteRule ^/about/who-uses-cc/?$ %{ENV:reqproto}://%{SERVER_NAME}/who-uses-cc [L,R=301]
RewriteRule .*/archive/archive.* %{ENV:reqproto}://%{SERVER_NAME}/ [L,R=301]
RewriteRule ^/asharedculture/?$ %{ENV:reqproto}://%{SERVER_NAME}/videos/a-shared-culture [L,R=301]
RewriteRule ^/audio/([-a-z0-9]+)/?$ /index.php?category_name=audio&name=$1 [L,QSA]
RewriteRule .*/author$ %{ENV:reqproto}://%{SERVER_NAME}/ [L,R=301]
RewriteRule ^/choose/devnations$ %{ENV:reqproto}://%{SERVER_NAME}/retiredlicenses [L,R=301]
RewriteRule ^/commoners(.*)?$ /interviews$1 [L,R=301]
RewriteRule ^/concepts/examples$ %{ENV:reqproto}://%{SERVER_NAME}/licenses/ [L,R=301]
RewriteRule ^/concepts/(.*)$ %{ENV:reqproto}://%{SERVER_NAME}/licenses/ [L,R=301]
RewriteRule ^/counter.* %{ENV:reqproto}://%{SERVER_NAME}/ [L,R=301]
RewriteRule ^(.*)CVS.*$ $1 [L,R=301]
RewriteRule ^/discuss/?$ %{ENV:reqproto}://%{SERVER_NAME}/contact#discuss [NE,R=301,L]
RewriteRule ^/draft/(.*)$ %{ENV:reqproto}://%{SERVER_NAME}/licenses/ [L,R=301]
RewriteRule /drafts/wiki_0.5$  %{ENV:reqproto}://%{SERVER_NAME}/licenses/by-sa/2.5/ [L,R=301]
RewriteRule ^/education/([-a-z0-9]+)/?$ /index.php?category_name=education&name=$1 [L,QSA]
RewriteRule ^/_.* %{ENV:reqproto}://%{SERVER_NAME}/ [L,R=301]
RewriteRule ^/features(.*)$ %{ENV:reqproto}://%{SERVER_NAME}/licenses/ [L,R=301]
RewriteRule ^/find.*$ http://search.creativecommons.org/ [L,R=301]
RewriteRule ^/freeculture.*$ http://lessig.org/freeculture [L,R=301]
RewriteRule ^/getcontent.*$ http://search.creativecommons.org/ [L,R=301]
RewriteRule http %{ENV:reqproto}://%{SERVER_NAME}/ [L,R=301]
RewriteRule ^/http.* %{ENV:reqproto}://%{SERVER_NAME}/ [L,R=301]
RewriteRule ^/icon/(.*)$ %{ENV:reqproto}://%{SERVER_NAME}/icons/$1 [L,R=301]
RewriteRule ^/image/([-a-z0-9]+)/?$ /index.php?category_name=image&name=$1 [L,QSA]
RewriteRule ^/images.*/$ %{ENV:reqproto}://%{SERVER_NAME}/ [L,R=301]
RewriteRule index_html %{ENV:reqproto}://%{SERVER_NAME}/ [L,R=301]
RewriteRule ^/interviews/([-a-z0-9]+)/?$ /index.php?category_name=interviews&name=$1 [QSA,L]
RewriteRule /learn/aboutus/$ %{ENV:reqproto}://%{SERVER_NAME}/about/history [L,R=301]
RewriteRule /learn/aboutus/people$ %{ENV:reqproto}://%{SERVER_NAME}/about/people [L,R=301]
RewriteRule /learn/artistscorners/educators$ %{ENV:reqproto}://%{SERVER_NAME}/education [L,R=301]
RewriteRule /learn/artistscorners/$ %{ENV:reqproto}://%{SERVER_NAME}/ [L,R=301]
RewriteRule /learn/artistscorners/filmmakers$ %{ENV:reqproto}://%{SERVER_NAME}/video [L,R=301]
RewriteRule /learn/artistscorners/musicians$ %{ENV:reqproto}://%{SERVER_NAME}/audio [L,R=301]
RewriteRule /learn/artistscorners/photographers$  %{ENV:reqproto}://%{SERVER_NAME}/image [L,R=301]
RewriteRule /learn/artistscorners/writers$ %{ENV:reqproto}://%{SERVER_NAME}/text [L,R=301]
RewriteRule ^/learn/features/(.*)$ http://search.creativecommons.org/ [L,R=301]
RewriteRule ^/learn/getcontent$ http://search.creativecommons.org/ [L,R=301]
RewriteRule /learn/legal/$ %{ENV:reqproto}://%{SERVER_NAME}/licenses/ [L,R=301]
RewriteRule /learn/licenses %{ENV:reqproto}://%{SERVER_NAME}/licenses/ [L,R=301]
RewriteRule /learn/$ %{ENV:reqproto}://%{SERVER_NAME}/about [L,R=301]
RewriteRule ^/learnmore/?$ %{ENV:reqproto}://%{SERVER_NAME}/about [L,R=301]
RewriteRule ^/legal/.*$ %{ENV:reqproto}://%{SERVER_NAME}/ [L,R=301]
RewriteRule .*/login_form$ %{ENV:reqproto}://%{SERVER_NAME}/ [L,R=301]
RewriteRule .*/manage.*$ %{ENV:reqproto}://%{SERVER_NAME}/ [L,R=301]
RewriteRule ^/media-that-matters-video/?$ %{ENV:reqproto}://%{SERVER_NAME}/videos/media-that-matters [L,R=301]
RewriteRule ^/news/blog/$ %{ENV:reqproto}://%{SERVER_NAME}/weblog [L,R=301]
RewriteRule ^/news/pressarchive.html$ %{ENV:reqproto}://%{SERVER_NAME}/weblog [L,R=301]
RewriteRule ^/news/pressarchive$ %{ENV:reqproto}://%{SERVER_NAME}/weblog [L,R=301]
RewriteRule ^/news/pressreleases %{ENV:reqproto}://%{SERVER_NAME}/press-releases [L,R=301]
RewriteRule ^/policy$ %{ENV:reqproto}://%{SERVER_NAME}/policies [L,R=301]
RewriteRule ^/press/.*$ %{ENV:reqproto}://%{SERVER_NAME}/weblog [L,R=301]
RewriteRule ^/press$ %{ENV:reqproto}://%{SERVER_NAME}/weblog [L,R=301]
RewriteRule ^/pressarchive$ %{ENV:reqproto}://%{SERVER_NAME}/weblog [L,R=301]
RewriteRule ^/presskit/(.+)\.([a-z]+)$ http://mirrors.creativecommons.org/presskit/$1.$2 [L,R=301]
RewriteRule ^/presskit %{ENV:reqproto}://%{SERVER_NAME}/about/press [R=301,L]
RewriteRule /projects/founderscopyright /give-the-user-a-404 [L]
RewriteRule /projects/sampling %{ENV:reqproto}://%{SERVER_NAME}/retiredlicenses [L,R=301]
RewriteRule /support/video$ %{ENV:reqproto}://%{SERVER_NAME}/videos [L,R=301]
RewriteRule ^/text/([-a-z0-9]+)/?$ /index.php?category_name=text&name=$1 [L,QSA]
RewriteRule ^/video/([-a-z0-9]+)/?$ /index.php?category_name=video&name=$1 [L,QSA]


#----------
# Farming out old/removed CC.org content to CC Wiki
#----------

RewriteRule ^/about/legal/cultivating http://wiki.creativecommons.org/Cultivating_the_Public_Domain [L,R=301]
RewriteRule ^/about/legal/?$  http://wiki.creativecommons.org/Legal_Concepts [L,R=301]
Rewriterule ^/about/licenses/comics1 http://wiki.creativecommons.org/Spectrumofrights_Comic1 [L,R=301]
Rewriterule ^/about/licenses/comics2 http://wiki.creativecommons.org/Spectrumofrights_Comic2 [L,R=301]
Rewriterule ^/about/licenses/comics3 http://wiki.creativecommons.org/Spectrumofrights_Comic3 [L,R=301]
Rewriterule ^/about/licenses/comics4 http://wiki.creativecommons.org/Spectrumofrights_Comic4 [L,R=301]
Rewriterule ^/about/licenses/examples http://wiki.creativecommons.org/License_Examples [L,R=301]
Rewriterule ^/about/licenses/fullrights http://wiki.creativecommons.org/Baseline_Rights [L,R=301]
Rewriterule ^/about/licenses/how1 http://wiki.creativecommons.org/Howitworks_Comic1 [L,R=301]
Rewriterule ^/about/licenses/how2 http://wiki.creativecommons.org/Howitworks_Comic2 [L,R=301]
Rewriterule ^/about/licenses/how3 http://wiki.creativecommons.org/Howitworks_Comic3 [L,R=301]
Rewriterule ^/about/licenses/how4 http://wiki.creativecommons.org/Howitworks_Comic4 [L,R=301]
RewriteRule ^/about/think/?$ http://wiki.creativecommons.org/Before_Licensing [R=301,L]
RewriteRule ^/audio/publish-internetarchive http://wiki.creativecommons.org/HOWTO_Publish#Internet_Archive [L,NE,R=301]
RewriteRule ^/audio/publish-morpheus http://wiki.creativecommons.org/HOWTO_Publish#Morpheus [L,NE,R=301]
RewriteRule ^/audio/publish-soundclick http://wiki.creativecommons.org/HOWTO_Publish#Soundclick [L,NE,R=301]
RewriteRule ^/audio/publish-website http://wiki.creativecommons.org/HOWTO_Publish#Adding_a_license_to_your_audio_page [L,NE,R=301]
RewriteRule ^/education/publish-website http://wiki.creativecommons.org/HOWTO_Publish#Adding_a_license_to_your_existing_website_2 [L,NE,R=301]
RewriteRule ^.*/embedding$ http://wiki.creativecommons.org/Embedded_Metadata [L,R=301]
RewriteRule ^/faq.*$ http://wiki.creativecommons.org/FAQ [L,R=301]
RewriteRule ^/image/publish-buzznet http://wiki.creativecommons.org/HOWTO_Publish#Buzznet [L,NE,R=301]
RewriteRule ^/image/publish-flickr http://wiki.creativecommons.org/HOWTO_Publish#Flickr [L,NE,R=301]
RewriteRule ^/image/publish-website http://wiki.creativecommons.org/HOWTO_Publish#Adding_a_license_to_your_photo_pages [L,NE,R=301]
RewriteRule ^/(international|affiliates)/?$ http://wiki.creativecommons.org/CC_Affiliate_Network [L,R=301]
RewriteRule ^/learn/aboutus/affiliates$ http://wiki.creativecommons.org/CC_Affiliate_Network [L,R=301]
RewriteRule ^/learn/collaborators$ http://wiki.creativecommons.org/CC_Affiliate_Network [L,R=301]
RewriteRule ^/metadata(.*)$ http://wiki.creativecommons.org/Metadata [L,R=301]
RewriteRule ^/participate/?$ http://wiki.creativecommons.org/ [L,R=301]
RewriteRule ^/project/(.*) http://wiki.creativecommons.org/$1 [L,R=301]
RewriteRule ^/projects/(.+) http://wiki.creativecommons.org/$1 [L,NE,R=301]
RewriteRule ^/projects/international(.*)$ http://wiki.creativecommons.org/CC_Affiliate_Network [L,R=301]
RewriteRule ^/salon/?$ http://wiki.creativecommons.org/Salon [L,R=301]
RewriteRule /technology/accessories$ http://wiki.creativecommons.org/Browser_Plugin [L,R=301]
RewriteRule /technology/challenges$ http://wiki.creativecommons.org/TechChallenges [L,R=301]
RewriteRule ^/technology/contributor.*$ http://wiki.creativecommons.org/Developer [L,R=301]
RewriteRule ^/technology/$ http://wiki.creativecommons.org/Developer [L,R=301]
RewriteRule ^.*/technology/.*$ http://wiki.creativecommons.org/Developer [L,R=301]
RewriteRule ^/technology/mp3$ http://wiki.creativecommons.org/MP3 [L,R=301]
RewriteRule ^/technology/screen.*$ http://wiki.creativecommons.org/Developer [L,R=301]
RewriteRule ^/technology/search.html$ http://search.creativecommons.org/ [L,R=301]
RewriteRule ^/technology/usingmarkup$ http://wiki.creativecommons.org/UsingMarkup [L,R=301]
RewriteRule ^/technology/web$ http://wiki.creativecommons.org/HOWTO_Tag_HTML_pages [L,R=301]
RewriteRule ^/technology/web-integration$ http://wiki.creativecommons.org/Web_Integration_Guide [L,R=301]
RewriteRule ^/technology/xmp.*$ http://wiki.creativecommons.org/XMP [L,R=301]
RewriteRule ^/text/publish-weblogs http://wiki.creativecommons.org/HOWTO_Publish#Blog [L,NE,R=301]
RewriteRule ^/text/publish-website http://wiki.creativecommons.org/HOWTO_Publish#Adding_a_license_to_your_existing_website [L,NE,R=301]
RewriteRule ^/tools/cclookup http://wiki.creativecommons.org/CcLookup [L,R=301]
RewriteRule ^/tools/ccpublisher http://wiki.creativecommons.org/CcPublisher [L,R=301]
RewriteRule ^/video/publish-internetarchive http://wiki.creativecommons.org/HOWTO_Publish#Internet_Archive_2 [L,NE,R=301]
RewriteRule ^/video/publish-website http://wiki.creativecommons.org/HOWTO_Publish#Adding_a_license_to_your_video_page [L,NE,R=301]
RewriteRule ^/wiki.* http://wiki.creativecommons.org/ [L,R=301]
RewriteRule ^/(worldwide|international)/translating http://wiki.creativecommons.org/Translating [L,R=301]
RewriteRule ^/worldwide http://wiki.creativecommons.org/CC_Affiliate_Network [L,R=301]


#---------- 
# Redirects to CC.net
#---------- 

RewriteRule ^/about/affiliates.*$ https://creativecommons.net/supporters [L,R=301]
RewriteRule ^/about/lessigletter.*$ https://creativecommons.net/letters [L,R=301]
RewriteRule ^/about/supporters$ https://creativecommons.net/supporters [L,R=301]
RewriteRule ^/donate$ https://creativecommons.net/donate [L,R=301]
RewriteRule /learn/aboutus/supporters$ https://creativecommons.net/supporters [L,R=301]
RewriteRule ^/store$ https://creativecommons.net/store [L,R=301]
RewriteRule /support/getabutton$ https://creativecommons.net/supportcc [L,R=301]
RewriteRule /support/summit$ https://creativecommons.net [L,R=301]
RewriteRule ^/support/?$ https://creativecommons.net/ [L,R=301]


#----------
# Miscellaneous
#----------

# Redirect www.CC.org to CC.org
RewriteCond %{HTTP_HOST} =www.creativecommons.org
RewriteRule ^/(.*)$ %{ENV:reqproto}://%{SERVER_NAME}/$1 [L,R=301]

# Redirect creativecommons.ru to the RU international page
ServerAlias creativecommons.ru www.creativecommons.ru
RewriteCond %{HTTP_HOST} =creativecommons.ru [OR]
RewriteCond %{HTTP_HOST} =www.creativecommons.ru
RewriteRule ^.*$ http://wiki.creativecommons.org/Ru:Заглавная+страница [L,R=302]

# Redirect opened.creativecommons.org to wiki.CC.org/OER
ServerAlias opened.creativecommons.org
RewriteCond %{HTTP_HOST} =opened.creativecommons.org
RewriteRule ^.*$ http://wiki.creativecommons.org/OER [L,R=301]

# It's creativecommons.org, not .com
RewriteCond %{HTTP_HOST} =creativecommons.com [OR]
RewriteCond %{HTTP_HOST} =www.creativecommons.com
RewriteRule ^.*$ %{ENV:reqproto}://%{SERVER_NAME}/ [L,R=301]

# Map backwardly named license types to their actual location
RewriteRule ^/licenses/by-nc-nd/1.0/(.*)$ %{ENV:reqproto}://%{SERVER_NAME}/licenses/by-nd-nc/1.0/$1 [L,R=301]
RewriteRule ^/licenses/by-nd-nc/2.0/(.*)$ %{ENV:reqproto}://%{SERVER_NAME}/licenses/by-nc-nd/2.0/$1 [L,R=301]

# Redirect any requests for URLs with *.svn* directly to our codebase
# to make it easier for people to hack our site by viewing the source
# with less hassles. :-) (nkinkade 2011-07-12)
RewriteRule ^/(.*)?/.svn/text-base/(.*).svn-base$ http://code.creativecommons.org/viewsvn/ccwordpress/branches/production/www/$1/$2\?view=markup [L,R=301]
RewriteRule .svn http://code.creativecommons.org/viewsvn/ccwordpress/branches/production/www/ [L,R=301]

# Map old intl|affiliates requests to new location on CC Wiki
RewriteCond %{REQUEST_URI} ^/(international|affiliates)/([a-z]+)/?$
RewriteRule ^.*$  http://wiki.creativecommons.org/${intl2wiki:%2|/Main_Page}
